<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Trovapp Pro</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4080/4080030.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        html, body { height: 100%; margin: 0; overflow: hidden; position: fixed; width: 100%; background-color: #F2F2F7; }
        #mainContainer { height: 100vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }

        /* TAG ORIZZONTALI - MASSIMA DENSIT√Ä */
        .tag-pill { cursor: pointer; border: 1px solid #E5E7EB; background: white; color: #3F3F46; font-weight: 700; padding: 2px 6px; border-radius: 5px; font-size: 8px; white-space: nowrap; }
        .tag-pill.active { background-color: #007AFF; color: white; border-color: #007AFF; }
        .tag-row { display: flex; gap: 3px; overflow-x: auto; padding: 1px 0; -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory; }
        .tag-row::-webkit-scrollbar { display: none; }
        
        .cat-box { background: white; border-radius: 8px; padding: 3px 6px; margin-bottom: 2px; border: 1px solid #F3F4F6; }
        .cat-label { font-size: 6.5px; font-weight: 900; color: #111827; text-transform: uppercase; opacity: 0.6; margin-bottom: 1px; }
        
        .modal-content {
            background: #F2F2F7;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: env(safe-area-inset-top, 5px) 10px 10px 10px;
        }

        .qty-badge { background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: 900; }
        .modal-up { animation: slideUp 0.25s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="mainContainer" class="p-4 pb-32">
        <header class="flex justify-between items-start mb-4">
            <div>
                <h1 id="titolo" class="text-3xl font-black tracking-tighter italic uppercase">TROVAPP</h1>
            </div>
            <button onclick="esportaDati()" class="text-[9px] bg-white border px-3 py-1 rounded-lg font-bold">üíæ BACKUP</button>
        </header>

        <div id="homeNav" class="space-y-4">
            <input type="text" id="searchInput" oninput="aggiorna()" placeholder="Cerca..." class="w-full p-3 bg-white rounded-xl shadow-sm outline-none">
            <nav class="grid grid-cols-2 gap-2">
                <button onclick="apriSpazio('CANTINA')" class="p-5 rounded-2xl bg-zinc-800 text-white font-black italic uppercase text-sm">Cantina</button>
                <button onclick="apriSpazio('SOFFITTA')" class="p-5 rounded-2xl bg-amber-600 text-white font-black italic uppercase text-sm">Soffitta</button>
                <button onclick="apriSpazio('ARMADI')" class="p-5 rounded-2xl bg-rose-600 text-white font-black italic uppercase text-sm">Armadi</button>
                <button onclick="apriSpazio('BOX')" class="p-5 rounded-2xl bg-indigo-700 text-white font-black italic uppercase text-sm">Box</button>
            </nav>
        </div>

        <button onclick="tornaHome()" id="backBtn" class="hidden w-full bg-black text-white p-3 rounded-xl font-black mb-4 uppercase">‚Üê Home</button>
        <div id="grid" class="grid grid-cols-2 gap-3 mt-4"></div>
    </div>

    <button onclick="apriModale()" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-blue-600 text-white w-14 h-14 rounded-full shadow-2xl z-50 text-2xl">
        <i class="fa-solid fa-plus"></i>
    </button>

    <div id="modal" class="hidden fixed inset-0 z-[60]">
        <div class="modal-content modal-up">
            <div class="flex justify-between items-center mb-1">
                <h3 class="text-md font-black italic uppercase">NUOVO OGGETTO</h3>
                <button onclick="chiudiModale()" class="text-2xl font-bold p-1">&times;</button>
            </div>

            <div class="flex gap-2 mb-2">
                <label class="w-14 h-14 shrink-0 bg-white border-2 border-dashed border-blue-200 rounded-xl flex items-center justify-center text-blue-600">
                    <i class="fa-solid fa-camera text-lg"></i>
                    <input type="file" id="fIn" accept="image/*" capture="environment" class="hidden" onchange="comprimeECarica()">
                </label>
                <div id="gallery" class="flex gap-1 overflow-x-auto no-scrollbar"></div>
                <div class="flex-1 grid grid-cols-1 gap-1">
                    <input id="nIn" type="text" placeholder="Nome" class="w-full p-1.5 bg-white rounded-lg text-[10px] font-bold border">
                    <input id="pIn" type="text" placeholder="Posizione" class="w-full p-1.5 bg-white rounded-lg text-[10px] border">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2 mb-2">
                <select id="cIn" class="p-1.5 bg-white rounded-lg text-[10px] font-bold border">
                    <option value="CANTINA">CANTINA</option><option value="SOFFITTA">SOFFITTA</option>
                    <option value="ARMADI">ARMADI</option><option value="BOX">BOX</option>
                </select>
                <div class="bg-zinc-900 text-white rounded-lg flex items-center justify-between px-2">
                    <span class="text-[9px] font-bold">QTY: <span id="qtyVal">1</span></span>
                    <div class="flex gap-1">
                        <button onclick="changeQty(-1)" class="w-5 h-5 bg-white/10 rounded">-</button>
                        <button onclick="changeQty(1)" class="w-5 h-5 bg-blue-600 rounded">+</button>
                    </div>
                </div>
            </div>

            <div id="tagEngine" class="flex-1 overflow-hidden space-y-0.5"></div>

            <button onclick="salva()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-black italic uppercase mt-2">Salva</button>
        </div>
    </div>

    <script>
        const CATEGORIE = {
            "üè† CASA": ["Gen. Casa", "Arredo", "Mobili", "Quadri", "Vasi", "Tende", "Cuscini", "Orologi", "Specchi", "Lampade", "Cornici", "Libri", "Tappeti", "Divani", "Sedie", "Tavoli", "Letti", "Materassi", "Lenzuola", "Coperte", "Piumoni", "Asciugamani", "Accappatoi", "Detersivi", "Pulizia", "Ferro Stiro", "Asse Stiro", "Ventilatori", "Stufe", "Deumidificatori", "Tazze", "Bicchieri", "Piatti", "Posate", "Vassoi", "Contenitori", "Spezie", "Dispensa", "Vino", "Acqua"],
            "üç≥ CUCINA": ["Gen. Cucina", "Piatti", "Bicchieri", "Posate", "Pentole", "Padelle", "Coperchi", "Mixer", "Frullatore", "Bilancia", "Forno", "Microonde", "Tostapane", "Bollitore", "Macchina Caff√®", "Capsule", "Coltelli", "Taglieri", "Mestoli", "Grattugia", "Scolapasta", "Teglie", "Stampi Dolce", "Grembiuli", "Tovaglioli", "Tovaglie", "Stoviglie", "Posacenere", "Carrello", "Dispensa", "Frigo", "Freezer", "Surgelati", "Conserve", "Pasta", "Riso", "Farina", "Zucchero", "Sale", "Olio"],
            "üß• VESTITI": ["Gen. Vestiti", "Cappotti", "Giacche", "Piumini", "Impermeabili", "Maglioni", "Cardigan", "Felpe", "T-Shirt", "Camicie", "Canotte", "Pantaloni", "Jeans", "Shorts", "Gonne", "Abiti", "Tute", "Intimo", "Calze", "Pigiami", "Scarpe", "Stivali", "Sneakers", "Sandali", "Ciabatte", "Borse", "Zaini", "Valigie", "Cinture", "Cappelli", "Guanti", "Sciarpe", "Cravatte", "Gioielli", "Orologi", "Occhiali", "Costumi", "Sportivo", "Lavoro", "Elegante"],
            "üõ† UTENSILI": ["Gen. Attrezzi", "Martello", "Cacciavite", "Pinze", "Chiavi", "Viti", "Bulloni", "Chiodi", "Tasselli", "Trapano", "Punte", "Smerigliatrice", "Sega", "Seghetto", "Livella", "Metro", "Nastro", "Colla", "Silicone", "Vernice", "Pennelli", "Rullo", "Scala", "Prolunga", "Torcia", "Batterie", "Lampadine", "Guanti Lavoro", "Mascherina", "Occhiali Prot", "Lubrificante", "Sbloccante", "Carta Vetro", "Stucco", "Pennelli", "Cesoie", "Pinzatrice", "Saldatore", "Tester", "Cassetta"],
            "üîå TECH": ["Gen. Tech", "Cavi", "Caricatori", "USB", "HDMI", "Powerbank", "Pile", "Batterie", "Audio", "Cuffie", "Casse", "Bluetooth", "PC", "Mouse", "Tastiera", "Monitor", "Hard Disk", "Chiavette", "Tablet", "Smartphone", "Macchina Foto", "Videocamera", "Treppiede", "Schede Memoria", "Router", "Modem", "Switch", "Console", "Joystick", "Giochi", "TV", "Telecomando", "Decoder", "Cavi Corrente", "Multipresa", "Adattatori", "Stampante", "Cartucce", "Scanner", "Webcam"],
            "‚öΩÔ∏è SPORT": ["Gen. Sport", "Palestra", "Pesi", "Manubri", "Elastici", "Tappetino", "Fitness", "Corsa", "Scarpe Sport", "Calcio", "Pallone", "Tennis", "Racchetta", "Padel", "Bici", "Casco", "Pompa", "Nuoto", "Cuffia", "Occhialini", "Sci", "Scarponi", "Trekking", "Zaino", "Borraccia", "Camping", "Tenda", "Sacco Pelo", "Pesca", "Yoga", "Boxe", "Guantoni", "Arrampicata", "Pattinaggio", "Skateboard", "Basket", "Volley", "Golf", "Danza", "Arti Marziali"],
            "üéÑ FESTE": ["Gen. Feste", "Natale", "Albero", "Luci", "Addobbi", "Presepe", "Palline", "Ghirlande", "Pasqua", "Uova", "Carnevale", "Costumi", "Halloween", "Decorazioni", "Compleanno", "Candeline", "Palloncini", "Festone", "Regali", "Carta Regalo", "Fiocchi", "Biglietti", "Party", "Bicchieri Plast", "Piatti Plast", "Cannucce", "Musica", "Fuochi", "Lanterne", "Coriandoli", "Stelle Filanti", "Maschere", "Trucco", "Cappellini", "Gadget", "Cerimonie", "Bomboniere", "Nozze", "Anniversario", "Laurea"],
            "üîÑ ALTRO": ["Gen. Altro", "Mistero", "Scatole", "Documenti", "Ricordi", "Foto", "Medicine", "Primo Soccorso", "Viaggio", "Auto", "Moto", "Accessori Auto", "Giardinaggio", "Piante", "Vasi", "Concime", "Animali", "Cibo Cani", "Cibo Gatti", "Giochi Animali", "Cancelleria", "Penne", "Quaderni", "Zaini", "Scuola", "Hobby", "Pittura", "Cucito", "Filati", "Ferri", "Libri vecchi", "Riviste", "Collezioni", "Da Vendere", "Da Regalare", "Da Buttare", "Rotto", "Da Riparare", "Bricolage", "Varie"]
        };

        let db = JSON.parse(localStorage.getItem('the_vault_vSearch')) || [];
        let tempPhotos = [], tempQty = 1, activeCat = "TUTTI";

        function initTagEngine() {
            const container = document.getElementById('tagEngine');
            container.innerHTML = "";
            for (const [cat, tags] of Object.entries(CATEGORIE)) {
                const section = document.createElement('div');
                section.className = "cat-box";
                section.innerHTML = `<div class="cat-label">${cat}</div><div class="tag-row no-scrollbar">${tags.map(t => `<span onclick="tg(this)" class="tag-pill">${t}</span>`).join('')}</div>`;
                container.appendChild(section);
            }
        }

        function tg(el) { el.classList.toggle('active'); }
        function changeQty(v) { tempQty = Math.max(1, tempQty + v); document.getElementById('qtyVal').innerText = tempQty; }
        function apriModale() { document.getElementById('modal').classList.remove('hidden'); }
        function chiudiModale() { document.getElementById('modal').classList.add('hidden'); resetModale(); }
        function apriSpazio(c) { activeCat = c; document.getElementById('homeNav').classList.add('hidden'); document.getElementById('backBtn').classList.remove('hidden'); aggiorna(); }
        function tornaHome() { activeCat = "TUTTI"; document.getElementById('homeNav').classList.remove('hidden'); document.getElementById('backBtn').classList.add('hidden'); aggiorna(); }

        function salva() {
            const nome = document.getElementById('nIn').value;
            if(!nome) return alert("Manca il nome!");
            const tags = Array.from(document.querySelectorAll('.tag-pill.active')).map(t => t.innerText);
            db.push({ id: Date.now(), nome, cat: document.getElementById('cIn').value, pos: document.getElementById('pIn').value, foto: [...tempPhotos], tags, qty: tempQty });
            localStorage.setItem('the_vault_vSearch', JSON.stringify(db));
            chiudiModale(); aggiorna();
        }

        function aggiorna() {
            const grid = document.getElementById('grid');
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const filtrati = db.filter(o => (activeCat === 'TUTTI' || o.cat === activeCat) && (o.nome.toLowerCase().includes(query) || o.tags.some(t => t.toLowerCase().includes(query))));
            document.getElementById('titolo').innerText = activeCat === 'TUTTI' ? "TROVAPP" : activeCat;
            grid.innerHTML = filtrati.reverse().map(o => `
                <div class="bg-white rounded-xl overflow-hidden shadow-sm relative border">
                    <img src="${o.foto[0] || ''}" class="w-full h-24 object-cover">
                    <div class="absolute top-1 left-1 qty-badge">x${o.qty}</div>
                    <div class="p-2">
                        <h4 class="font-black text-[8px] truncate uppercase italic">${o.nome}</h4>
                        <p class="text-[7px] text-blue-600 font-bold uppercase">${o.pos || '---'}</p>
                    </div>
                    <button onclick="elimina(${o.id})" class="absolute top-1 right-1 text-red-500 text-[10px]">√ó</button>
                </div>`).join('');
        }

        function elimina(id) { if(confirm('Eliminare?')) { db = db.filter(o => o.id !== id); localStorage.setItem('the_vault_vSearch', JSON.stringify(db)); aggiorna(); } }
        function resetModale() { document.getElementById('nIn').value = ""; document.getElementById('pIn').value = ""; tempPhotos = []; tempQty = 1; document.getElementById('qtyVal').innerText = "1"; document.getElementById('gallery').innerHTML = ""; document.querySelectorAll('.tag-pill').forEach(t => t.classList.remove('active')); }

        function esportaDati() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
            const dl = document.createElement('a'); dl.href = dataStr; dl.download = "backup.json"; dl.click();
        }

        function comprimeECarica() {
            const file = document.getElementById('fIn').files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image(); img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX = 400; const scale = MAX / Math.max(img.width, img.height);
                    canvas.width = img.width * scale; canvas.height = img.height * scale;
                    canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
                    tempPhotos.push(canvas.toDataURL('image/jpeg', 0.6));
                    document.getElementById('gallery').innerHTML = tempPhotos.map(f => `<img src="${f}" class="w-14 h-14 object-cover rounded-xl">`).join('');
                };
            };
            reader.readAsDataURL(file);
        }

        initTagEngine(); aggiorna();
    </script>
</body>
</html>
