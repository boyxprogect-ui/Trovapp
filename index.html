<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Trovapp Pro - Full Image Search</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { -webkit-tap-highlight-color: transparent; user-select: none; -webkit-user-select: none; }
        input { user-select: text !important; -webkit-user-select: text !important; }

        html, body { height: 100%; margin: 0; background-color: #F2F2F7; font-family: -apple-system, sans-serif; }
        
        #mainContainer { 
            min-height: 100vh; padding: 16px; padding-bottom: 120px; 
            display: flex; flex-direction: column; overflow-y: auto;
        }

        /* ROW DI RICERCA: Una affianco all'altra con scorrimento */
        .search-row { 
            display: flex; overflow-x: auto; gap: 12px; padding: 10px 4px;
            scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;
        }
        .search-row::-webkit-scrollbar { display: none; }
        
        /* SCHEDA: Proporzionata per il layout orizzontale */
        .item-card { 
            flex: 0 0 140px; scroll-snap-align: start; background: white; 
            border-radius: 20px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            display: flex; flex-direction: column;
        }

        /* FOTO: Non tagliata (contain) e proporzionata */
        .item-card img { 
            width: 100%; height: 100px; object-fit: contain; 
            background: #f9f9f9; display: block;
        }
        
        .qty-badge { position: absolute; top: 6px; left: 6px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 8px; font-size: 8px; font-weight: 900; }
    </style>
</head>
<body>

    <div id="mainContainer">
        <header class="flex justify-between items-center mb-5 order-1">
            <h1 class="text-2xl font-black italic uppercase tracking-tighter">TROVAPP</h1>
            <button onclick="esportaDati()" class="bg-zinc-900 text-white p-2 rounded-lg text-[8px] font-black">BACKUP</button>
        </header>

        <div class="order-2">
            <input type="text" id="searchInput" oninput="aggiorna()" placeholder="Cerca un oggetto..." class="w-full p-4 bg-white rounded-2xl shadow-sm outline-none text-sm font-medium border-0 mb-4">
        </div>

        <div id="searchResults" class="order-5 mb-6">
            <div id="gridSearch" class="search-row"></div>
        </div>

        <div id="homeNav" class="space-y-4 mb-4 order-4">
            <nav id="navGrid" class="grid grid-cols-2 gap-3"></nav>
            <button onclick="apriMenuNuovoSpazio()" class="w-full py-4 border-2 border-dashed border-gray-200 rounded-[24px] text-gray-400 font-black italic uppercase text-xs">+ NUOVO SPAZIO</button>
        </div>
    </div>

    <button id="addButton" style="position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:#2563eb; color:white; width:60px; height:60px; border-radius:50%; z-index:100; font-size:24px;" onclick="apriModale()"><i class="fa-solid fa-plus"></i></button>

    <script>
        let db = JSON.parse(localStorage.getItem('the_vault_vSearch')) || [];
        let configSpazi = JSON.parse(localStorage.getItem('configSpazi')) || [{nome:'CANTINA',colore:'bg-zinc-800'},{nome:'SOFFITTA',colore:'bg-amber-600'}];

        function renderBottoni() {
            const nav = document.getElementById('navGrid');
            nav.innerHTML = configSpazi.map(s => `
                <button onclick="apriSpazio('${s.nome}')" class="p-5 rounded-[28px] ${s.colore} text-white shadow-lg flex flex-col active:scale-95 transition-transform">
                    <span class="font-black italic text-[13px] uppercase">${s.nome}</span>
                </button>
            `).join('');
        }

        function aggiorna() {
            const gs = document.getElementById('gridSearch'), resDiv = document.getElementById('searchResults');
            const q = document.getElementById('searchInput').value.toLowerCase();
            
            // Logica di spostamento: Se scrivi, i risultati salgono sopra i bottoni
            if(q.length > 0) {
                resDiv.style.order = "3";
            } else {
                resDiv.style.order = "5";
            }

            const f = db.filter(o => o.nome.toLowerCase().includes(q) || (o.tags && o.tags.some(t => t.toLowerCase().includes(q))));
            
            // Render delle schede una affianco all'altra
            gs.innerHTML = f.reverse().map(o => `
                <div class="item-card" onclick="apriModale(${o.id})">
                    <div style="position:relative">
                        <div class="qty-badge">x${o.qty}</div>
                        <img src="${o.foto[0] || ''}">
                    </div>
                    <div class="p-2">
                        <p class="text-[6px] font-black text-gray-400 uppercase">${o.cat}</p>
                        <h4 class="font-black text-[9px] truncate uppercase italic text-gray-800">${o.nome}</h4>
                        <p class="text-[7px] font-bold text-blue-600 uppercase">${o.pos || 'Senza pos.'}</p>
                    </div>
                </div>
            `).join('');
        }

        renderBottoni();
        aggiorna();
    </script>
</body>
</html>
